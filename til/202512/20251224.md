### [*] NGINX에 대해서 단기 학습

아래와 같은 서버 블럭이 하나 있따.

/etc/nginx/nginx.conf 경로에 파일이 default.conf 파일이 있따.

```
server {
  listen 80;
  server_name localhost;

  location / {
    root /usr/share/nginx/html;
    index hello.html

  }

}
```
간단하게 설명하면 하나의 server블럭이 있고 
localhost:80 으로 들어온 사용자이면서 /** 모든 경로는 
root에 있는 패키지에 있는 hello.html파일을 사용자에게 반환한다는 뜻이다.

### 문법 정상적으로 동작하는지 일종의 컴파일 느낌이 명령어
```
sudo nginx -t  //컴파일 명령어인듯?
sudo nginx -s reload // 파일을 만든뒤 reload해야 작동한다. 
```

### Nginx 디버깅 방법
```
/var/log/nginx  << 여기 경로 들어가면 access.log 와 error.log 파일이 2개 존재한다.
sudo tail -f access.log  최근 10줄의 로그 글을 보여준다.
sudo tail -f error.log 최근 10줄의 에러로그글을 보여준다. 
```

쉽게 생각해보니 프론트 코드를 컴파일 후 index.html 이 생긴 경로를 root에 경로에 달고
index부분에 index.html파일을 적어 놓으면 nignix로 쉽게 프론트 배포가 가능하다는것을 느꼈다.

### https 적용해보기 nginx랑 certbot으로 간단하게 적용하기
이 명령어만 입력해주면 default.conf 파일에 certbot이 알아서 작성해준다.
간단한 라이브러리라고 한다.
```
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /user/bin/certbot
sudo certbot --nginx -d <도메인주소>
```

### 원래 default.conf 파일에 경로를 설정했는데 server블록을 분리할고 싶을 수도 있다.
그러면 특정경로 예를들어 /website/tbntb.conf , /websit/admin.tbntb.conf 형태로 분리한 뒤
default.conf은 아래와 같이 만들어 주면 라우팅이 된다.

```
include /website/tbntb.conf;
include /website/admin.tbntb.conf;

아니면 include /website/*.conf 와일드 카드 써도 된다.
```

### 포워드 프록시란? Forward Proxy
보내려고 하는 요청을 관리 또는 보안 처리를 위한 용도로 사용하는 서버를 포워드 프록시라고한다.
포워드 프록시 서버의 대표적이 예시로 회사 방화벽이 있다. 삼성 직원들은 gpt를 쓰지 못하게 하는 형태
회사 내부에 있는 컴퓨터로 cahtgpt에 접속하려는데 차단되는 경우가 있다. 포워드 프록시 서버가  보내려고 하는 요청을 
감시하면서 위험하다고 판단되는 사이트에 접속하지 못하게 차단 설정을 한 것이다.

### 리버스 프록시란?
들어오는 요청을 관리 또는 보안처리를 하기 위한 용도로 사용하는 서버를 리버스 프록시라고한다.
리버스 프록시 서버의 대표적은 예시가 https처리, 요청수 제한, 로드밸런싱을 하는 용도로 사용하는 nginx가 있다. 
리버스 프록시 서버가 들어오는 요청의 보안 처리를 하기 위해 https처리를 한다. 그리고 들어오는 요청을
감시하다가 일정 요청수 이상을 보낼 때도 차단을 하게끔 설정할 수 있다. 또한 들어오는 요청을 여러대의 서버로
분배해주는 역할인 로드밸런서 기능을 하게끔 세탕힐 수 있다.

이거 쓰는 이유가 들어오는 요청을 관리 또는 보안처리를 하기 위해 사용한다.

### 프록시 nginx에서 사용해보기
만약 https적용하고 싶으면 위에 certbot명령어 입력하면 된다.
```
server{
  listen 80;
  server_name api.tbntb.co.kr

  location / {
    proxy_pass http://localhost:8080;
  }

}
```

### 요청 수 제한 방법 nginx로
.conf 파일에들어가서
맨 위에 아래와 같은 명령어를 입력한다.
```
limit_req_zone $binary_remote_addr zone=mylimit:10m   rate=3r/s;

```
- limit_req_zone 은 nginx에서 자체적으로 만든 변수 명이다. 공간 및 요청수 정의하는 파라미터
- binary_remote_addr 클라이언트의 ip주소를 기반으로 한다는 소리
- zone=mylimit 메모리 공간의 이름을 mylimit으로 설정  10mega
- rate=3r/s  1초에 3개정도 요청

```
limit_req_zone $binary_remote_addr zone=mylimit:10m   rate=3r/s;

server{
  limit_req zone = mylimit;
  limit_req_status 429;
  listen 80;
  server_name api.tbntb.co.kr

  location / {
    proxy_pass http://localhost:8080;
  }

}
```

### 로드밸런서 기능인 nginx
.conf 파일에 아래와 같은 명령어를 추가한다.
backend 로 변수를 바꿔 껴놓은 느낌?? 
```
upstream backend {
  server localhost:8080;
  server localhost:8081;
}

server{
  limit_req zone = mylimit;
  limit_req_status 429;
  listen 80;
  server_name api.tbntb.co.kr

  location / {
    proxy_pass http://backend;
  }

}
```

### L4 

TCP가 뭐야? 
연결 지향 프로토콜이다.

그래서 처음 연결할 때 3way handshake 과정을 거치고 종료할 때는 4way handshake를 거친다.
3way handshake가 아니라 2 way면 안돼?? 
응 안돼 -> 지연된 syn 패킷이 도착하는 경우, 이전 연결의 패킷이 살아 있는 경우, half-open connection 문제 발생
그렇다면 4way handshake에서 마지막 timewait을 하는 이유는? 아직 도착하지 못한 패킷이 네트워크 상에 존재할 수 있기 때문, 마지막 ack유실 대비
같으 포트 총둘 대비

이정도면 될듯 ?? 

특징은 ?? 
1. 신뢰성
2. 순서보장
3. 흐름제어
4. 혼잡제어


신뢰성을 어케 보장해?? 핸드쉐이크 과정을 통해서
순서 보장은 ??? receive buffer라는게 있는데 여기서 받아노 패킷들을 정렬한뒤 중복 패킷을 제거해 그리고 애플리케이션 단에서 달라고 해야하지 그 때 줌
흐름제어는?? rwnd 와 cwnd 의 최소값을 기준으로 패킷의 데이터 상한선을 정해 
rwnd 란? receive window size 라고 생각하면 좋아 받아야 되는 세그먼트 수 를 정해주는 느낌 cwnd는 네트워크상희 현재 받을 수있는 상한선
이 친구들은 슬라이딩 윈도우 알고리즘을 이용한다. ack에 보통 rwnd랑 같이 받는데 널널하다하면 윈도우 증가 아니면 감소 형태로

zwp가 뭐야?? 
zero window 포로토콜을 의미한다.
이게 먼데?? 주기적으로 송신자 측엥서 1바이트 정도 패킷을 보낸다. 그러다가 ack패킷을 열어보니 rwnd값이 >0 큰순간 이제 보낼 수 있단느 뜻이므로
이러한 프로토콜을 의미한다.
왜 좋아?? rwnd ==0 인 상태면 지연 문제 네트워크 병목지점이 ㅂ라생하기 때

### 혼잡제어 알려줘 
송신측에서 timeout이나 ack 중복 3번 수신시 네트워크가 현재 혼잡하다는걸 인지하고 보내는 패킷의 양을 조절해야 한다.
그렇지 않게 되면 큐잉증가로 인한 패킷 손실 , 재전송작업, 트래픽 과부화 네트워크 장애로 이어진다.

4개의 알고리즘이
slow start , congestion avoidance, fast retransmit, fast recovery 
1부터 시작하여 지수적으로 증가하다가 선형증가 , 만약 ack3번오면 해당 ㅐ패킷을 재전송, 그러다가 timeout 발생시 1로 다시 slowstart 

AIMD 라는게 천천히 증가 급격히 감소 절반 라는

### Retransmission 
이 친구는 혼잡제어에서 재전송 절차에 대한 이야기다
크게 timeout 에 의한 그리고 중복 ack 3번에 의한것으로 나눈다.
여기에는 kans 알고리즘과 Expotential Backoff 라는 개념이나온다.
전자는 최초 전송에 대한 것인지 재전송에 대한 것인지 판단하기 위하 알고리즘 
규칙은 재전송에 의한 rtt시가은 제외하고 rto시간을 지수적응로 증가시킨다.
Expoetenial backoff 가 rto 시간을 1 24 8 등으로 증가시키는 거 


### DNS 
도메인 -> local os stube resolver -> recursive Resolver -> root DNS -> TLD dns -> Authoritative DNS server -> 끝 다시 회귀하여 캐싱을 적용한다.

geoDNS , gSLB 
dns를  지역별 트래픽 가중치별로 로드밸런싱을 해줘서 트래픽을 완화해주는 것들


### 로드밸런서

L4로드밸런서 -> tcp계층기반 ip기반으로 라우팅을진행 속도가 빠르다느 장점
l7 로드밸런서 -> api, query, 요청 , 기타 정보 예를들어 세션 등의 정보를 토대로 라우팅을 진행 - 일종의 리벅스 프록시, 부하분
관련된 알고리즘에는 
1. round robin
2. weithgt round robin
3. least connection
4. fast response
5. hash 기바 ㄴ알고리즘
6. consisitent hash 알고리

한 유저를 특정 서버에만 로드ㅐ밸런싱 하고 싶을 경우가 있을거다 그런걸 
sticky session이라 한다.
1. 쿠키 에 라우팅 정보를 담기
2. 해시기반으로 하기
핫키 문제, 기존 서버가 망가질경우 서버 재배치 문제 등 

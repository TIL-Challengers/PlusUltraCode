### 학교 서버로 self-hosted 적용하기

오늘은 self-hosted를 이용하여 cicd 파이프라인을 완성했다.

간단하게 설명하겠다.

1. github Action을 이용하여 java를 컴파일 한 뒤 docker 이미지를 만들고 ecr저장소로 push
2. self-hosted 라벨이 등록된 runner가 주기적으로 github에서 event를 polling 작업을 진행한다.
3. 만약 event가 발생하게 된다면 해당 작업을 실행하여 서버를 띄우게 된다.

### 작업 도중 만난 문제점 기억나는 부분들만.. 

해당 컴퓨터에 aws ecr을 접속해야 되기 때문에 aws-cli 을 꼭 다운해주자.

DB_HOST에서 MYSQL, REDIS, KAFKA를 띄우지 않아 APP_SERVER들이 작동을 하지 않게 되었다. 

또한 MYSQL이 혹시 커넥션 풀로 가득 찰 수 있기 때문에 각 서비스마다 고유한 DB를 지정해 주었다.

KAFKA와 REDIS는 자신이 어디 서버에 있는지를 명시해 줘야 한다. KAFKA는 COMPOSE.YML파일에 REDIS는 APPLICATION.YML파일에 명시해 줬다.

현재 문제는 SWAGGER에서 NEWS_LETTER서버가 들어가지 않는 문제다. 

그래서 기존 api.sejongssg.kr 도메인 주소로 등록되어 있어서 해당 부분을 실제 private ip로 변경한 뒤 연결을 해주었다.

api.sejongssg.kr 은 유저가 타이핑 시 ssg 실제 서버 public ip로 라우팅 된 후 라우팅 매핑 조건에 의해 추가적으로 private Ip 서브넷으로 이동하게 된다.
그러나 이 부분은 현재 관리자가 설정 중이라고 한다.

만약 해결책을 찾지 못하겠다면 최후의 수단으로 new_letter서비스를 없애고 다른 서비스로 합병하는 방법도 좋은 생각이라 한다. 이 참에 서비스 하나 줄이고.. 1석 2조?
